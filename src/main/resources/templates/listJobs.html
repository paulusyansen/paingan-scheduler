<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:th="http://www.thymeleaf.org">
<style>
/* .pagination { */
/* 	display: inline-block; */
/* } */
/* .pagination a { */
/* 	color: black; */
/* 	float: left; */
/* 	padding: 5px 5px; */
/* 	text-decoration: none; */
/* } */
/* .pagination a.active { */
/* 	background-color: gray; */
/* 	color: white; */
/* 	border-radius: 2px; */
/* } */
</style>
	<head>
		<title>Scheduler UI (beta)</title>
		
		<link rel="stylesheet" type="text/css" href="webjars/bootstrap/4.1.0/css/bootstrap.min.css" />
		<link rel="stylesheet" type="text/css" href="webjars/sweetalert2/dist/sweetalert2.min.css" />
		
		<script type="text/javascript" src="webjars/jquery/3.3.1/jquery.min.js"></script>
		<script type="text/javascript" src="webjars/bootstrap/4.1.0/js/bootstrap.min.js"></script>
		<script type="text/javascript" src="webjars/bootstrap-table/1.9.1/bootstrap-table.min.js"></script>
		<script type="text/javascript" src="webjars/sweetalert2/dist/sweetalert2.min.js"></script>

		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	</head>
<body>


<main role="main" class="container">

		<form th:replace="/fragments/form.html :: form"> </form>
		
		<hr class="mb-4">
		
		<div class="table-responsive">
			<table class="table table-hover">
			    <thead class="thead-dark" th:replace="/fragments/table.html :: fields(~{ :: .myFields})">
		            <tr class="myFields">
		                <th>ID</th>
		                <th>Name</th>
		                <th>Group</th>
		                <th>Cron Human Exp</th>
		                <th>Template</th>
		                <th>Note</th>
		                <th>Action</th>
		            </tr>
			    </thead>
			    
			    <div th:replace="/fragments/table.html :: tableBody(tableData=${jobsPage.content})"></div>
			</table>
		</div>
		
		
		<nav th:replace="/fragments/table.html :: pagination(pages=${jobsPage}, pageNumbers= ${pageNumbers})" aria-label="..."></nav>
		
		<nav aria-label="...">
  <ul class="pagination pagination-sm">
    <li class="page-item disabled">
      <a class="page-link" href="#" tabindex="-1">1</a>
    </li>
    <li class="page-item"><a class="page-link" href="#">2</a></li>
    <li class="page-item"><a class="page-link" href="#">3</a></li>
  </ul>
</nav>

</main>

<!--     <h1>Book List</h1> -->
<!--     <table border="1"> -->
<!--         <thead> -->
<!--             <tr> -->
<!--                 <th th:text="#{msg.id}" /> -->
<!--                 <th th:text="#{msg.name}" /> -->
<!--             </tr> -->
<!--         </thead> -->
<!--         <tbody> -->
<!--             <tr th:each="book, iStat : ${jobsPage.content}" -->
<!--                 th:style="${iStat.odd}? 'font-weight: bold;'" -->
<!--                 th:alt-title="${iStat.even}? 'even' : 'odd'"> -->
<!--                 <td th:text="${book.id}" /> -->
<!--                 <td th:text="${book.jobName}" /> -->
<!--             </tr> -->
<!--         </tbody> -->
<!--     </table> -->
<!--     <div th:if="${jobsPage.totalPages > 0}" class="pagination" -->
<!--         th:each="pageNumber : ${pageNumbers}"> -->
<!--         <a th:href="@{/listJobs(size=${jobsPage.size}, page=${pageNumber})}" -->
<!--             th:text=${pageNumber} -->
<!--             th:class="${pageNumber==jobsPage.number + 1} ? active"></a> -->
<!--     </div> -->

<!--     <div> -->
<!--         <p> -->
<!--             <a th:href="@{/}" th:text="#{msg.Home}"></a> -->
<!--         </p> -->
<!--     </div> -->
</body>



<script type="text/javascript">
		
			function submit() {
				var data = {};
				
				$("button.btn").addClass("disabled");
				
				$("#schedulerForm :input")
					.serializeArray()
					.map( function(x) {
						data[x.name] = x.value;
					});
				
				$.ajax({
					  method: "POST",
					  url: "api/create",
					  contentType : "application/json",
					  data: JSON.stringify(data)
				}).done( function( msg ) {
					$("#schedulerForm :input").each( function() { $(this).val(""); });
				    $("#schedulerTable").bootstrapTable('refresh');
				    
				    swal({
				    	  type: 'success',
				    	  title: 'Submit Success',
				    	  text: msg.message
				    });
				});
				
				
		        
				$("button.btn").removeClass("disabled");
			}
		
			function responseHandler(data) {
				if( data.data != null && data.data.total != null)
					return data.data;
				else
					return {"rows":[],"total" : 0};
			}
			
			function actionFormatter( value, row ,index ) {
				
				var action = ( row.jobActive === true ) ?
						'<button onclick="stop('+ row.id +')" type="button" class="pause btn btn-warning">Pause</button>' :
						'<button onclick="start('+ row.id +')" type="button" class="start btn btn-success">Start</button>';
				
				var edit = "<button onclick='edit("+ JSON.stringify(row) +")' type='button' class='edit btn btn-primary'>Edit</button>";
				var del = '<button onclick="del('+ row.id +')" type="button" class="delete btn btn-danger">Delete</button>'
						
				return  action + '&nbsp' + edit + '&nbsp' + del; 
				
			}
			
			function del( id ) {
				$.ajax({
					  method: "GET",
					  url: "api/delete/" + id
				}).done( function( msg ) {
				    $("#schedulerTable").bootstrapTable('refresh');
				    
				    swal({
				    	  type: 'success',
				    	  title: 'Delete Success',
				    	  text: msg.message
				    });
				});
			}
			
			function edit( row ) {
				$.each(row, function(key, value) {
				    $('#schedulerForm [name='+key+']').val(value);
				});
			}
			
			
			function start( id ) {
				$.ajax({
					  method: "GET",
					  url: "api/start/" + id
				}).done( function( msg ) {
				    $("#schedulerTable").bootstrapTable('refresh');
				    
				    swal({
				    	  type: 'success',
				    	  title: 'Start Success',
				    	  text: msg.message
				    });
				});
			}
			
			function stop( id ) {
				$.ajax({
					  method: "GET",
					  url: "api/stop/" + id
				}).done( function( msg ) {
				    $("#schedulerTable").bootstrapTable('refresh');
				    
				    swal({
				    	  type: 'success',
				    	  title: 'Stop Success',
				    	  text: msg.message
				    });
				});
			}
			
		</script>
</html>